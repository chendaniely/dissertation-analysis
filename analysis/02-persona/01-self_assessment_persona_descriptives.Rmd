---
title: "Self-Assessment Descriptives"
output: 
  html_document: 
    toc: yes
    number_sections: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, message=FALSE}
library(here)
library(readr)
library(jsonlite)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(fs)
library(stringi)
library(knitr)
library(kableExtra)
library(viridis)

source(here("./R/plot_question_bar.R"))
source(here("./R/likert.R"))

metadata <- jsonlite::read_json(here("./data/final/01-surveys/01-self_assessment_persona_metadata.json"))
persona <- readr::read_tsv(here("./data/final/01-surveys/01-self_assessment_persona_with_questions.tsv"))

counts <- persona %>%
  dplyr::group_by(qbase, question_text) %>%
  dplyr::count(response) %>%
  tidyr::drop_na()
```

```{r}
# plot_question_bar(dplyr::filter(counts, qbase==unique(counts$qbase)[[11]]))
```

## Other responses

```{r}
persona %>%
  dplyr::filter(stringr::str_detect(question_part, "TEXT")) %>%
  tidyr::drop_na() %>%
  group_by(question_part) %>%
  count(response) %>%
  print(n = 50)
```


# Question Bar Graphs

```{r, fig.width=8, fig.height=5}
fs::dir_create(here("./output", "survey", "01-self_assessment"), recurse = TRUE)

for (q in unique(counts$qbase)) {
  print(q)
  if (q %in% c("Q7.2", "Q7.3", "Q7.4")) {next}

  g <- plot_question_bar(dplyr::filter(counts, qbase == q))
  pth <- here("./output", "survey", "01-self_assessment", glue::glue("{q}.png"))
  #print(pth)
  print(g)
  ggsave(filename = pth, plot = g, width = 8, height = 5, units = "in")
}
```

# Likert table

```{r, fig.width=8, fig.height=5}
qbase <- "Q7.2"
qid <- get_qid_from_qbase(persona, qbase)
qid

likert_q_count <- likert_calculation(persona, metadata, qbase, qid)
g <- likert_plot(likert_q_count %>% tidyr::drop_na())
g
```

```{r}
ggsave(filename = here("./output", "survey", "01-self_assessment", "likert.png"),
       plot = g,
       width = 8,
       height = 5,
       units = "in")
```



# Free Response

- Q7.3: Please share what you most hope to learn from participating in this workshop and/or workshop series. 
- Q7.4: What do you want to know or be able to do after this workshop (or series of sessions) that you don't know or can't do right now?

## Paired responses

```{r}
persona %>%
  dplyr::filter(qbase == "Q7.3" | qbase == "Q7.4") %>%
  dplyr::select(id, qbase, response) %>%
  tidyr::pivot_wider(names_from = qbase, values_from = response) %>%
  dplyr::filter(! (is.na(Q7.3) & is.na(Q7.4))) %>%
  knitr::kable() %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover"))
  
```


## All responses

```{r}
persona %>%
  dplyr::filter(qbase == "Q7.3") %>%
  dplyr::select(response) %>%
  tidyr::drop_na() %>%
  dplyr::pull(1)
```

```{r}
persona %>%
  dplyr::filter(qbase == "Q7.4") %>%
  dplyr::select(response) %>%
  tidyr::drop_na() %>%
  dplyr::pull(1)
```
